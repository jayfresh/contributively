<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Contributively - peer-reviewed contributions to projects</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>
		<script type="text/javascript">
			var store = [];
			$(document).ready(function() {
				var addNameToList = function(name) {
					var addToTable = function() {
						var table = $('#nameList table');
						var htmlString = '<tr><td>'+name+'</td></tr>';
						if(table.children().length!==0) {
							var id = $('#nameList input').length+1;
							htmlString += '<tr><td><input type="text" id="'+(id+1)+'" /></td></tr><tr><td><input type="text" id="'+id+'" /></td></tr>';
						}
						table.prepend(htmlString);
					};
					var saveToStore = function(successCallback,live) {
						if(live) {
							var data = {
								name:name
							};
							var callback = function(data) {
								if(data.indexOf("added successfully")!==-1) {
									$('#nameList .ajax').remove();
									successCallback();
								} else {
									$('#nameList .ajax').addClass('error').html(name+' not saved on server! Try again.</div>');
								}
							};
							$('#nameList').prepend('<div class="ajax">Sending...</div>');
							if(
								window.Components &&
								window.netscape &&
								window.netscape.security &&
								document.location.protocol.indexOf("http") == -1) {
							window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
							}
							$.post("http://contributively.appjet.net",data,callback,"html");
						} else {
							// mimicing behaviour in contributively.appjet.net
							for(var i=0;i<store.length;i++) {
								store[i].position++;
							}
							store.push({
								name:name,
								position:1
							});
							successCallback();
						}
					};
					saveToStore(addToTable);
				};
				$('#nameForm .submit').click(function() {
					var name = $('#name').val();
					addNameToList(name);
					return false;
				});
				$('#nameList').change(function(ev) {
					var target = ev.target;
					var id = parseInt(target.id,10);
					var amount = target.value;
					// check to see its only digits and less than or equal to 100
					if(amount.match(/^\d+$/) && amount <= 100) {
						var partnerId = id%2===0 ? id-1 : id+1;
						var partner = $('#'+partnerId);
						partner.val(100-amount);
					}
				});
			});
		</script>
	</head>
	<body>
		<div id="container">
			<div id="nameForm">
				<form action="/">
					<label for="name">Add name</label>
					<input id="name" type="text"></input>
					<input type="submit" class="submit" value="Add"></input>
				</form>
			</div>
			<div id="nameList">
				<table></table>
			</div>
		</div>
	</body>
</html>
